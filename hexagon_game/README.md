# 三角连锁棋(共享六边形棋盘游戏)

## 项目简介

这是一个基于 Flask 的多人共享六边形棋盘游戏。玩家通过网页选择颜色，在棋盘上依次放置线条，围成三角形并染色，最终填满所有三角形即游戏结束。支持悔棋、重置等功能，适合多人协作或对抗。

---

## 新增：多棋盘支持

- 现在每个棋盘都有唯一的 8 位字母数字 ID，所有数据仅在该棋盘内共享。
- 访问页面时，URL 必须带有 `?board_id=xxxxxxxx` 参数。例如：
  - `http://localhost:35101/?board_id=Ab12Cd34`
- 如果直接访问 `/`，页面会自动生成一个新的棋盘 ID 并跳转。
- 不同棋盘的数据完全隔离，互不影响。可以多开页面体验多个棋盘。
- 当某个棋盘的所有页面都关闭后，后端会自动销毁该棋盘数据（约2分钟无人访问后）。
- 本地存储的颜色等信息也按棋盘隔离。

---

## 游戏规则

- 棋盘为六边形，由点组成，每行点数为：4, 5, 6, 7, 6, 5, 4。
- 每位玩家进入页面后，需选择一个颜色作为身份。
- 玩家每回合可在棋盘上放置一条长度为4的直线（覆盖4个连续的点，且必须为直线，不能与已有线完全重合）。
- 放置线条后，如果新围成了一个小三角形（可以与其他已有的任何颜色的线一起围成），则该三角形会被染上当前线条的颜色。
- 每个三角形只能被染色一次，归属于第一个围成它的玩家。
- 游戏持续进行，直到所有三角形都被染色，游戏结束。
- 支持悔棋（只能撤销自己下的最后一步），支持棋盘重置。

## 主要功能

- 六边形棋盘渲染与交互
- 多人颜色选择与身份识别
- 线条放置与规则校验
- 三角形自动染色与计分
- 分数榜实时更新
- 悔棋与重置功能
- 响应式美观前端界面
- **多棋盘隔离与自动销毁**

## 部署与运行

1. **环境准备**
   - Python 3.7+
   - pip

2. **安装依赖**
   ```bash
   pip install flask
   ```

3. **运行项目**
   ```bash
   python app.py
   ```
   默认监听 `http://localhost:35101/`，可在浏览器访问。

4. **文件结构**
   ```
   ├── app.py                # Flask后端主程序
   ├── templates/
   │   └── index.html        # 前端页面模板
   ├── static/
   │   ├── style.css         # 前端样式
   │   └── main.js           # 前端交互逻辑
   └── README.md             # 项目说明
   ```

## 技术说明

- 前端：原生 HTML + CSS + JavaScript，响应式布局，SVG 绘制棋盘。
- 后端：Flask，使用全局变量存储多个棋盘状态，支持多人实时同步。
- 状态同步：前端每2秒自动轮询后端，获取最新棋盘状态。
- 悔棋与重置：后端保存历史状态，支持撤销和重置操作。
- **多棋盘：所有请求都需带上 board_id，数据完全隔离，支持自动销毁无人访问的棋盘。**
- **标准gamestate：遵循Playground统一规范，提供标准化的游戏状态接口。**

## API接口规范

### `/api/gamestate` - 获取游戏状态

返回标准格式的游戏状态，包含以下字段：

- `your_turn`: 是否轮到当前玩家 (1=是, 0=否)
- `game_info`: 游戏基本信息（类型、大小、获胜条件等）
- `board`: 棋盘状态矩阵
- `board_legend`: 棋盘数值说明
- `game_progress`: 游戏进度（当前回合、移动次数、历史等）
- `metadata`: 元数据（棋盘ID、创建时间、版本等）
- `my_color`: 当前玩家颜色
- `players`: 所有玩家颜色列表
- `scores`: 各玩家得分
- `line_counts`: 各玩家连线数
- `last_move_color`: 最后移动的玩家颜色
- `game_over`: 游戏是否结束
- `message`: 游戏消息
- `points`: 六边形坐标点（兼容性字段）
- `lines`: 已绘制的线条（兼容性字段）
- `captured_triangles`: 已捕获的三角形（兼容性字段）

### 示例响应

```json
{
  "your_turn": 1,
  "game_info": {
    "game_type": "六边形连线游戏",
    "board_size": 7,
    "winning_condition": "占有三角形最多的玩家获胜",
    "current_phase": "playing",
    "game_status": "active",
    "current_turn": 1
  },
  "board": [...],
  "board_legend": {...},
  "game_progress": {...},
  "metadata": {...},
  "my_color": "#d9534f",
  "players": ["#d9534f", "#428bca", "#5cb85c", "#f0ad4e", "#6e409e"],
  "scores": {...},
  "line_counts": {...},
  "last_move_color": "#d9534f",
  "game_over": false,
  "message": "轮到红色玩家操作",
  "points": [...],
  "lines": [...],
  "captured_triangles": [...]
}
```

## 玩法演示

1. 打开网页，选择你的颜色。
2. 点击棋盘上的两个点，自动选择一条长度为4的直线。
3. 若该线围成了新的三角形，则自动染色并计分。
4. 可点击“悔棋”撤销自己刚刚的操作。
5. 所有三角形被染色后，游戏结束。
6. 可多开页面体验不同棋盘，互不影响。

## 贡献与反馈

欢迎提出建议、反馈 bug 或提交 PR。

---

如需自定义棋盘、颜色或规则，请修改 `app.py` 和 `static/main.js`。 